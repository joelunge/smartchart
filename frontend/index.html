<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SmartChart</title>
    <link rel="stylesheet" href="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.css">
    <style>
        body { font-family: sans-serif; margin: 0; padding: 1rem; }
        #chart { height: 600px; }
    </style>
</head>
<body>
    <label for="tf">Timeframe:</label>
    <select id="tf">
        <option value="1m">1m</option>
        <option value="5m">5m</option>
        <option value="15m">15m</option>
        <option value="1h">1h</option>
        <option value="4h">4h</option>
    </select>

    <div id="chart"></div>

    <script type="module">
import { createChart } from 'https://unpkg.com/lightweight-charts/dist/lightweight-charts.esm.development.js';

const chart  = createChart(document.getElementById('chart'), { height: 600 });
const series = chart.addCandlestickSeries();
const tfSel  = document.getElementById('tf');
const BASE   = 'http://localhost:5000';

async function load(tf) {
  const url = `${BASE}/api/candles?symbol=BTCUSDT&tf=${tf}&limit=500`;
  console.log('fetch', url);
  const res  = await fetch(url);
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  const data = await res.json();
  series.setData(data);
}

tfSel.addEventListener('change', () => load(tfSel.value));
load(tfSel.value);
    </script>
</body>
</html>
